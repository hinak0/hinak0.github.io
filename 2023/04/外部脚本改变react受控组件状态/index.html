<!DOCTYPE html><html lang="en" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"><title>外部脚本改变react受控组件状态 | ONE NOTE</title><meta name="author" content="hinak0"><meta name="copyright" content="hinak0"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="最近写一个浏览器脚本，需要实现一个自动化输入的功能，也就是脚本改变输入框内容．网页是使用react写的，记录一下． 如何更改（原理）直接element.value &#x3D; xx赋值当然不行，因为状态保存在组件实例中，直接更改的话，会在下一次视图刷新中被还原 使用js修改组件实例呢？也不行．因为在外部js,无法获得实例对象，实例是一个闭包． 于是只能用模拟触发输入时的事件来触发数据绑定，进而实现修改实例"><meta property="og:type" content="article"><meta property="og:title" content="外部脚本改变react受控组件状态"><meta property="og:url" content="https://hinak0.github.io/2023/04/%E5%A4%96%E9%83%A8%E8%84%9A%E6%9C%AC%E6%94%B9%E5%8F%98react%E5%8F%97%E6%8E%A7%E7%BB%84%E4%BB%B6%E7%8A%B6%E6%80%81/index.html"><meta property="og:site_name" content="ONE NOTE"><meta property="og:description" content="最近写一个浏览器脚本，需要实现一个自动化输入的功能，也就是脚本改变输入框内容．网页是使用react写的，记录一下． 如何更改（原理）直接element.value &#x3D; xx赋值当然不行，因为状态保存在组件实例中，直接更改的话，会在下一次视图刷新中被还原 使用js修改组件实例呢？也不行．因为在外部js,无法获得实例对象，实例是一个闭包． 于是只能用模拟触发输入时的事件来触发数据绑定，进而实现修改实例"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://hinak0.github.io/covers/cover5.png"><meta property="article:published_time" content="2023-04-26T07:04:55.000Z"><meta property="article:modified_time" content="2024-11-17T10:54:10.734Z"><meta property="article:author" content="hinak0"><meta property="article:tag" content="technology"><meta property="article:tag" content="program"><meta property="article:tag" content="japanese"><meta property="article:tag" content="network"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://hinak0.github.io/covers/cover5.png"><link rel="shortcut icon" href="/covers/avatar.png"><link rel="canonical" href="https://hinak0.github.io/2023/04/%E5%A4%96%E9%83%A8%E8%84%9A%E6%9C%AC%E6%94%B9%E5%8F%98react%E5%8F%97%E6%8E%A7%E7%BB%84%E4%BB%B6%E7%8A%B6%E6%80%81/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="stylesheet" href="/css/index.css?v=5.2.2"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.6.0/css/all.min.css"><script>(()=>{var e={set:(e,t,a)=>{a&&(a=Date.now()+864e5*a,localStorage.setItem(e,JSON.stringify({value:t,expiry:a})))},get:e=>{var t=localStorage.getItem(e);if(t){var{value:t,expiry:a}=JSON.parse(t);if(!(Date.now()>a))return t;localStorage.removeItem(e)}}},t=(window.btf={saveToLocal:e,getScript:(o,n={})=>new Promise((e,t)=>{let a=document.createElement("script");a.src=o,a.async=!0,Object.entries(n).forEach(([e,t])=>a.setAttribute(e,t)),a.onload=a.onreadystatechange=()=>{a.readyState&&!/loaded|complete/.test(a.readyState)||e()},a.onerror=t,document.head.appendChild(a)}),getCSS:(o,n)=>new Promise((e,t)=>{let a=document.createElement("link");a.rel="stylesheet",a.href=o,n&&(a.id=n),a.onload=a.onreadystatechange=()=>{a.readyState&&!/loaded|complete/.test(a.readyState)||e()},a.onerror=t,document.head.appendChild(a)}),addGlobalFn:(e,t,a=!1,o=window)=>{var n;e.startsWith("pjax")||((n=o.globalFn||{})[e]=n[e]||{},n[e][a||Object.keys(n[e]).length]=t,o.globalFn=n)}},()=>{document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#0d0d0d")}),a=()=>{document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#ffffff")},o=(btf.activateDarkMode=t,btf.activateLightMode=a,e.get("theme")),t=("dark"===o?t():"light"===o&&a(),e.get("aside-status"));void 0!==t&&document.documentElement.classList.toggle("hide-aside","hide"===t);/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add("apple")})()</script><script>let GLOBAL_CONFIG={root:"/",algolia:void 0,localSearch:void 0,translate:void 0,highlight:{plugin:"highlight.js",highlightCopy:!0,highlightLang:!0,highlightHeightLimit:!1,highlightFullpage:!1,highlightMacStyle:!1},copy:{success:"Copy Successful",error:"Copy Failed",noSupport:"Browser Not Supported"},relativeDate:{homepage:!1,post:!1},runtime:"",dateSuffix:{just:"Just now",min:"minutes ago",hour:"hours ago",day:"days ago",month:"months ago"},copyright:void 0,lightbox:"null",Snackbar:void 0,infinitegrid:{js:"https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js",buttonText:"Load More"},isPhotoFigcaption:!0,islazyload:!1,isAnchor:!0,percent:{toc:!0,rightside:!1},autoDarkmode:!1}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"外部脚本改变react受控组件状态",isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,isShuoshuo:!1}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/covers/avatar.png" onerror='onerror=null,src="/img/friend_404.gif"' alt="avatar"></div><div class="site-data text-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">101</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">7</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tools/"><i class="fa-fw fas fa-toolbox"></i><span> Tools</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image:url(covers/cover5.png)"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="/covers/avatar.png" alt="Logo"><span class="site-name">ONE NOTE</span></a><a class="nav-page-title" href="/"><span class="site-name">外部脚本改变react受控组件状态</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tools/"><i class="fa-fw fas fa-toolbox"></i><span> Tools</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">外部脚本改变react受控组件状态</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="fa-fw post-meta-icon far fa-calendar-alt"></i><span class="post-meta-label">Created</span><time datetime="2023-04-26T07:04:55.000Z" title="Created 2023-04-26 15:04:55">2023-04-26</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Code-Program/">Code &amp; Program</a></span></div><div class="meta-secondline"></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><div id="post-outdate-notice" data="{&quot;limitDay&quot;:30,&quot;messagePrev&quot;:&quot;It has been&quot;,&quot;messageNext&quot;:&quot;days since the last update, the content of the article may be outdated.&quot;,&quot;postUpdate&quot;:&quot;2024-11-17 18:54:10&quot;}" hidden></div><p>最近写一个浏览器脚本，需要实现一个自动化输入的功能，也就是脚本改变输入框内容．网页是使用react写的，记录一下．</p><h2 id="如何更改（原理）"><a href="#如何更改（原理）" class="headerlink" title="如何更改（原理）"></a>如何更改（原理）</h2><p>直接<code>element.value = xx</code>赋值当然不行，因为状态保存在组件实例中，直接更改的话，会在下一次视图刷新中被还原</p><p>使用js修改组件实例呢？也不行．因为在外部js,无法获得实例对象，实例是一个闭包．</p><p>于是只能用模拟触发输入时的事件来触发数据绑定，进而实现修改实例．</p><p>触发事件时，单单<code>input.dispatchEvent()</code>还不够，在react中要有特别的方法才能成功触发绑定函数，如下：</p><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> input = someInput;</span><br><span class="line"><span class="keyword">let</span> lastValue = input.<span class="property">value</span>;</span><br><span class="line">input.<span class="property">value</span> = <span class="string">&quot;new value&quot;</span>;</span><br><span class="line"><span class="keyword">let</span> event = <span class="keyword">new</span> <span class="title class_">Event</span>(<span class="string">&quot;input&quot;</span>, &#123; <span class="attr">bubbles</span>: <span class="literal">true</span> &#125;);</span><br><span class="line"><span class="comment">// hack React15</span></span><br><span class="line">event.<span class="property">simulated</span> = <span class="literal">true</span>;</span><br><span class="line"><span class="comment">// hack React16 内部定义了descriptor拦截value，此处重置状态</span></span><br><span class="line"><span class="keyword">let</span> tracker = input.<span class="property">_valueTracker</span>;</span><br><span class="line"><span class="keyword">if</span> (tracker) &#123;</span><br><span class="line">	tracker.<span class="title function_">setValue</span>(lastValue);</span><br><span class="line">&#125;</span><br><span class="line">input.<span class="title function_">dispatchEvent</span>(event);</span><br></pre></td></tr></table></figure><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a target="_blank" rel="noopener" href="https://github.com/ILovePing/ILovePing.github.io/issues/22">js如何在外部改变react受控组件的状态量？</a></p></article><div class="tag_share"><div class="post-share"><div class="social-share" data-image="/covers/cover5.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.4/sharejs/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.4/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2023/04/%E6%97%A5%E6%9C%AC%E8%AA%9E-%E7%AC%AC%E5%85%AB%E5%BC%B9/" title="日本語-第八弹"><img class="cover" src="/covers/cover3.png" onerror='onerror=null,src="/img/404.jpg"' alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">Previous</div><div class="info-item-2">日本語-第八弹</div></div><div class="info-2"><div class="info-item-1">二类形容词与一类形容词不同，不一定以 い 结尾，亦无特定变化方法． 肯定&#x2F;过去时： です&#x2F;でした 京都「きょうと」の 紅葉「もみじ」は 有名「ゆうめい」です。 この通り「とおり」は 静かです「しずか」。 否定： では ありません &#x2F; では ありませんでした この通りは 静か では ありませんでした。 昨日は 暇「ひま」 じゃ ありませんでした。 名詞は 二类形容词な 名です xx是xx的xx 奈良「なら」は 静かな 街「まち」です 文法名詞でした 表示过去 一昨日「おととい」は 休み でした 昨日は 水曜日でした どんな 什么样的 張さんは どんな 人ですか？ どうてすか and どでしだか前者询问对现在或者未来事情的看法，后者询问过去． でも そして 表示转折表达词 綺麗です・きれいです(二类形容词) おとといは 雨でした 表示天气这么用 あれえ ところで 转换话题的语句 世界中「せかいじゅ」 日本中 常见的表达 形容词+の おもしろいのが あります 这里的no表示前文的指代，省略 面白い本が あります 紅葉 有 もみじ 和 こうよう...</div></div></div></a><a class="pagination-related" href="/2023/04/%E6%97%A5%E6%9C%AC%E8%AA%9E-%E7%AC%AC%E4%B8%83%E5%BC%B9/" title="日本語-第七弹"><img class="cover" src="/covers/cover3.png" onerror='onerror=null,src="/img/404.jpg"' alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">Next</div><div class="info-item-2">日本語-第七弹</div></div><div class="info-2"><div class="info-item-1">形容词一类形容词＆二类形容词一类 い结尾 汉字＋い 二类 い结尾，但是可以直接写成汉字 肯定与否定い ＋ です 熱い ー 熱いです 寒い「さむい」 ー 寒いです 辛い「からい」 ー 辛いです い ー＞ くない or くありません 熱い ー 熱くないです ー 熱くありません 寒い「さむい」 ー 寒くないです ー 寒くありません 辛い「からい」 ー 辛くないです ー 辛くありません 过去时い ー かった 今日は 暑いです。 昨日は 暑かったです。 过去否定い ー くなかった or くありませんでした 旅行は 楽しかった です 昨日は 寒くなかった です 昨日は 寒くありません でした 十年前、王さんは 高くなかった「たかい」 です。 文法を ー は 表示一种对比． 私は 昨日は 休みました。「和平时对比」 私の部屋に 電話があります。 私の部屋には 電話がありません。「和别人对比」 韓国へは 行きました。 中国へは 行きませんでした。「韓国和中国对比」 コーヒーを 飲みます。 コーヒーは...</div></div></div></a></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/covers/avatar.png" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="avatar"></div><div class="author-info-name">hinak0</div><div class="author-info-description">Recording personal notes, covering various aspects.</div><div class="site-data"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">101</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">7</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/hinak0"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/hinak0" target="_blank" title="Github"><i class="fab fa-github" style="color:#24292e"></i></a><a class="social-icon" href="mailto:hinak0@qq.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color:#4a7dbe"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E6%9B%B4%E6%94%B9%EF%BC%88%E5%8E%9F%E7%90%86%EF%BC%89"><span class="toc-number">1.</span> <span class="toc-text">如何更改（原理）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81"><span class="toc-number">2.</span> <span class="toc-text">代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-number">3.</span> <span class="toc-text">参考</span></a></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2022 - 2024 By hinak0</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light and Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.2.2"></script><script src="/js/main.js?v=5.2.2"></script><div class="js-pjax"></div></div></body></html>
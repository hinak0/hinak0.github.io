document.addEventListener("DOMContentLoaded",()=>{let t,e;let n=false;const o=n=>{const o=t=>Array.from(t).reduce((t,e)=>t+e.offsetWidth,0);if(n){const n=o(document.querySelector("#blog-info > a").children);const s=o(document.getElementById("menus").children);t=n+s;e=document.getElementById("nav")}const s=window.innerWidth<=768||t>e.offsetWidth-120;e.classList.toggle("hide-menu",s)};const s=()=>{o(true);e.classList.add("show")};const i={open:()=>{btf.overflowPaddingR.add();btf.animateIn(document.getElementById("menu-mask"),"to_show 0.5s");document.getElementById("sidebar-menus").classList.add("open");n=true},close:()=>{btf.overflowPaddingR.remove();btf.animateOut(document.getElementById("menu-mask"),"to_hide 0.5s");document.getElementById("sidebar-menus").classList.remove("open");n=false}};const c=()=>{const t=()=>{btf.scrollToDest(document.getElementById("content-inner").offsetTop,300)};const e=document.getElementById("scroll-down");e&&btf.addEventListenerPjax(e,"click",t)};const a=()=>{const t=GLOBAL_CONFIG.highlight;if(!t)return;const{highlightCopy:e,highlightLang:n,highlightHeightLimit:o,highlightFullpage:s,highlightMacStyle:i,plugin:c}=t;const a=GLOBAL_CONFIG_SITE.isHighlightShrink;const r=e||n||a!==undefined||s||i;const l=c==="highlight.js"?document.querySelectorAll("figure.highlight"):document.querySelectorAll('pre[class*="language-"]');if(!((r||o)&&l.length))return;const d=c==="prismjs";const u=a===true?"closed":"";const f=a!==undefined?'<i class="fas fa-angle-down expand"></i>':"";const g=e?'<i class="fas fa-paste copy-button"></i>':"";const m='<div class="macStyle"><div class="mac-close"></div><div class="mac-minimize"></div><div class="mac-maximize"></div></div>';const h=s?'<i class="fa-solid fa-up-right-and-down-left-from-center fullpage-button"></i>':"";const p=(t,e)=>{if(GLOBAL_CONFIG.Snackbar!==undefined){btf.snackbarShow(e)}else{const n=document.createElement("div");n.className="copy-notice";n.textContent=e;document.body.appendChild(n);const o=t.getBoundingClientRect();const s=window.pageYOffset||document.documentElement.scrollTop;const i=window.pageXOffset||document.documentElement.scrollLeft;const c=o.top+s-40;const a=o.left+i+o.width/2;const r=t.closest("figure.highlight").classList.contains("code-fullpage")?c+60:c;n.style.cssText=`\n      top: ${r+10}px;\n      left: ${a}px;\n      transform: translateX(-50%);\n      opacity: 0;\n      transition: opacity 0.3s ease, top 0.3s ease;\n    `;requestAnimationFrame(()=>{n.style.opacity="1";n.style.top=`${r}px`});setTimeout(()=>{n.style.opacity="0";n.style.top=`${r+10}px`;setTimeout(()=>{n?.remove()},300)},800)}};const L=async(t,e)=>{try{await navigator.clipboard.writeText(t);p(e,GLOBAL_CONFIG.copy.success)}catch(t){console.error("Failed to copy: ",t);p(e,GLOBAL_CONFIG.copy.noSupport)}};const b=(t,e)=>{const n=t.parentNode;n.classList.add("copy-true");const o=d?"pre code":"table .code pre";const s=n.querySelector(o);if(!s)return;L(s.innerText,e);n.classList.remove("copy-true")};const y=t=>t.classList.toggle("closed");const v=(t,e)=>{const n=t.closest("figure.highlight");const o=n.classList.toggle("code-fullpage");document.body.style.overflow=o?"hidden":"";e.classList.toggle("fa-down-left-and-up-right-to-center",o);e.classList.toggle("fa-up-right-and-down-left-from-center",!o)};const w=t=>{const e=t.target.classList;const n=t.currentTarget;if(e.contains("expand"))y(n);else if(e.contains("copy-button"))b(n,t.target);else if(e.contains("fullpage-button"))v(n,t.target)};const E=t=>t.currentTarget.classList.toggle("expand-done");const I=t=>{const e=new Map;const n=()=>{let n=t;while(n!==document.body&&n!=null){if(window.getComputedStyle(n).display==="none"){e.set(n,n.getAttribute("style")||"")}n=n.parentNode}const o="visibility: hidden !important; display: block !important;";e.forEach((t,e)=>{e.setAttribute("style",t?t+";"+o:o)})};const o=()=>{e.forEach((t,e)=>{if(t==="")e.removeAttribute("style");else e.setAttribute("style",t)})};n();const s=t.offsetHeight;o();return s};const G=(t,e)=>{const n=document.createDocumentFragment();if(r){const e=document.createElement("div");e.className=`highlight-tools ${u}`;e.innerHTML=m+f+t+g+h;btf.addEventListenerPjax(e,"click",w);n.appendChild(e)}if(o&&I(e)>o+30){const t=document.createElement("div");t.className="code-expand-btn";t.innerHTML='<i class="fas fa-angle-double-down"></i>';btf.addEventListenerPjax(t,"click",E);n.appendChild(t)}d?e.parentNode.insertBefore(n,e):e.insertBefore(n,e.firstChild)};l.forEach(t=>{let e="";if(d)btf.wrap(t,"figure",{class:"highlight"});if(!n){G("",t);return}if(d){e=t.getAttribute("data-language")||"Code"}else{e=t.getAttribute("class").split(" ")[1];if(e==="plain"||e===undefined)e="Code"}G(`<div class="code-lang">${e}</div>`,t)})};const r=()=>{if(!GLOBAL_CONFIG.isPhotoFigcaption)return;document.querySelectorAll("#article-container img").forEach(t=>{const e=t.title||t.alt;if(!e)return;const n=document.createElement("div");n.className="img-alt text-center";n.textContent=e;t.insertAdjacentElement("afterend",n)})};const l=()=>{btf.loadLightbox(document.querySelectorAll("#article-container img:not(.no-lightbox)"))};const d=async t=>{try{const e=await fetch(t);return await e.json()}catch(t){console.error("Failed to fetch URL:",t);return[]}};const u=(t,e,n)=>{const{isButton:o,limit:s,firstLimit:i,tabs:c}=n;const a=e.length;const r=Math.ceil((a-i)/s+1);const l={gap:5,isConstantSize:true,sizeRange:[150,600],useTransform:true};const d=new InfiniteGrid.JustifiedInfiniteGrid(t,l);let u=false;const f=t=>t&&t.replace(/"/g,"&quot;")||"";const g=t=>{const e=t.alt?`alt="${f(t.alt)}"`:"";const n=t.title?`title="${f(t.title)}"`:"";return`<div class="item">\n        <img src="${t.url}" data-grid-maintained-target="true" ${e} ${n} />\n      </div>`};const m=(t,n,o=false)=>{const s=o?(t-1)*n:(t-2)*n+i;return e.slice(s,s+n).map(g)};const h=t=>{const e=document.createElement("button");e.innerHTML=`${GLOBAL_CONFIG.infinitegrid.buttonText}<i class="fa-solid fa-arrow-down"></i>`;e.addEventListener("click",()=>{e.remove();btf.setLoading.add(t);p(d.getGroups().length+1,s)},{once:true});t.insertAdjacentElement("afterend",e)};const p=(t,e,n)=>{d.append(m(t,e,n),t)};const L=e=>{if(c){const e=t.parentNode;if(u){e.style.visibility="visible"}if(t.offsetHeight===0){e.style.visibility="hidden";u=true}}const{updated:n,isResize:s,mounted:i}=e;if(!n.length||!i.length||s)return;btf.loadLightbox(t.querySelectorAll("img:not(.medium-zoom-image)"));if(d.getGroups().length===r){btf.setLoading.remove(t);!c&&d.off("renderComplete",L);return}if(o){btf.setLoading.remove(t);h(t)}};const b=btf.debounce(t=>{const e=(+t.groupKey||0)+1;if(e===1)p(e,i,true);else p(e,s);if(e===r)d.off("requestAppend",b)},300);btf.setLoading.add(t);d.on("renderComplete",L);if(o){p(1,i,true)}else{d.on("requestAppend",b);d.renderItems()}btf.addGlobalFn("pjaxSendOnce",()=>d.destroy())};const f=async(t,e=false)=>{if(!t.length)return;const n=async()=>{for(const n of t){if(btf.isHidden(n)||n.classList.contains("loaded"))continue;const t={isButton:n.getAttribute("data-button")==="true",limit:parseInt(n.getAttribute("data-limit"),10),firstLimit:parseInt(n.getAttribute("data-first"),10),tabs:e};const o=n.firstElementChild;const s=o.textContent;o.textContent="";n.classList.add("loaded");try{const e=n.getAttribute("data-type")==="url"?await d(s):JSON.parse(s);u(o,e,t)}catch(t){console.error("Gallery data parsing failed:",t)}}};if(typeof InfiniteGrid==="function"){await n()}else{await btf.getScript(GLOBAL_CONFIG.infinitegrid.js);await n()}};const g=t=>{const e=btf.getScrollPercent(t,document.body);const n=document.getElementById("go-up");if(e<95){n.classList.add("show-percent");n.querySelector(".scroll-percent").textContent=e}else{n.classList.remove("show-percent")}};const m=()=>{const t=document.getElementById("rightside");const e=window.innerHeight+56;let n=0;const o=document.getElementById("page-header");const s=typeof chatBtn!=="undefined";const i=GLOBAL_CONFIG.percent.rightside;const c=()=>{if(document.body.scrollHeight<=e){t.classList.add("rightside-show");return true}return false};if(c())return;const a=t=>{const e=t>n;n=t;return e};let r="";const l=btf.throttle(()=>{const e=window.scrollY||document.documentElement.scrollTop;const n=a(e);if(e>56){if(r===""){o.classList.add("nav-fixed");t.classList.add("rightside-show")}if(n){if(r!=="down"){o.classList.remove("nav-visible");s&&window.chatBtn.hide();r="down"}}else{if(r!=="up"){o.classList.add("nav-visible");s&&window.chatBtn.show();r="up"}}}else{r="";if(e===0){o.classList.remove("nav-fixed","nav-visible")}t.classList.remove("rightside-show")}i&&g(e);c()},300);btf.addEventListenerPjax(window,"scroll",l,{passive:true})};const h=()=>{const t=GLOBAL_CONFIG_SITE.isToc;const e=GLOBAL_CONFIG.isAnchor;const n=document.getElementById("article-container");if(!(n&&(t||e)))return;let o,s,i,c,a;if(t){const t=document.getElementById("card-toc");s=t.querySelector(".toc-content");o=s.querySelectorAll(".toc-link");c=t.querySelector(".toc-percentage");a=s.classList.contains("is-expand");const e=e=>{const n=e.target.closest(".toc-link");if(!n)return;e.preventDefault();btf.scrollToDest(btf.getEleTop(document.getElementById(decodeURI(n.getAttribute("href")).replace("#",""))),300);if(window.innerWidth<900){t.classList.remove("open")}};btf.addEventListenerPjax(s,"click",e);i=t=>{const e=s.clientHeight;const n=t.offsetTop;const o=t.clientHeight;const i=s.scrollTop;const c=n-i;const a=(e-o)/2;if(c!==a){s.scrollTop=i+(c-a)}};s.style.display="block"}const r=n.querySelectorAll("h1,h2,h3,h4,h5,h6");let l="";const d=n=>{if(n===0)return false;let c="";let d="";for(let t=0;t<r.length;t++){const e=r[t];if(n>btf.getEleTop(e)-80){const n=e.id;c=n?"#"+encodeURI(n):"";d=t}else{break}}if(l===d)return;if(e)btf.updateAnchor(c);l=d;if(t){s.querySelectorAll(".active").forEach(t=>t.classList.remove("active"));if(c){const t=o[d];t.classList.add("active");setTimeout(()=>i(t),0);if(!a){let e=t.parentNode;while(!e.matches(".toc")){if(e.matches("li"))e.classList.add("active");e=e.parentNode}}}}};const u=btf.throttle(()=>{const e=window.scrollY||document.documentElement.scrollTop;if(t&&GLOBAL_CONFIG.percent.toc){c.textContent=btf.getScrollPercent(e,n)}d(e)},100);btf.addEventListenerPjax(window,"scroll",u,{passive:true})};const p=t=>{const e=window.globalFn||{};const n=e.themeChange||{};if(!n){return}Object.keys(n).forEach(e=>{const o=n[e];if(["disqus","disqusjs"].includes(e)){setTimeout(()=>o(t),300)}else{o(t)}})};const L={readmode:()=>{const t=document.body;const e=document.createElement("button");const n=()=>{t.classList.remove("read-mode");e.remove();e.removeEventListener("click",n)};t.classList.add("read-mode");e.type="button";e.className="fas fa-sign-out-alt exit-readmode";e.addEventListener("click",n);t.appendChild(e)},darkmode:()=>{const t=document.documentElement.getAttribute("data-theme")==="dark"?"light":"dark";if(t==="dark"){btf.activateDarkMode();GLOBAL_CONFIG.Snackbar!==undefined&&btf.snackbarShow(GLOBAL_CONFIG.Snackbar.day_to_night)}else{btf.activateLightMode();GLOBAL_CONFIG.Snackbar!==undefined&&btf.snackbarShow(GLOBAL_CONFIG.Snackbar.night_to_day)}btf.saveToLocal.set("theme",t,2);p(t)},"rightside-config":t=>{const e=t.firstElementChild;if(e.classList.contains("show")){e.classList.add("status");setTimeout(()=>{e.classList.remove("status")},300)}e.classList.toggle("show")},"go-up":()=>{btf.scrollToDest(0,500)},"hide-aside-btn":()=>{const t=document.documentElement.classList;const e=t.contains("hide-aside")?"show":"hide";btf.saveToLocal.set("aside-status",e,2);t.toggle("hide-aside")},"mobile-toc-button":(t,e)=>{const n=document.getElementById("card-toc");n.style.transition="transform 0.3s ease-in-out";const o=n.clientHeight;const s=e.getBoundingClientRect();const i=window.innerHeight-s.bottom-30;if(o>i){n.style.transformOrigin=`right ${o-i-s.height/2}px`}n.classList.toggle("open");n.addEventListener("transitionend",()=>{n.style.cssText=""},{once:true})},"chat-btn":()=>{window.chatBtnFn()},translateLink:()=>{window.translateFn.translatePage()}};document.getElementById("rightside").addEventListener("click",t=>{const e=t.target.closest("[id]");if(e&&L[e.id]){L[e.id](t.currentTarget,e)}});const b=()=>{const t=t=>{const e=t.target.closest(".site-page.group");if(!e)return;e.classList.toggle("hide")};const e=document.querySelector("#sidebar-menus .menus_items");e&&e.addEventListener("click",t)};const y=()=>{const t=document.getElementById("toggle-menu");if(!t)return;btf.addEventListenerPjax(t,"click",()=>{i.open()})};const v=()=>{const{limitCount:t,languages:e}=GLOBAL_CONFIG.copyright;const n=n=>{n.preventDefault();const o=window.getSelection(0).toString();let s=o;if(o.length>t){s=`${o}\n\n\n${e.author}\n${e.link}${window.location.href}\n${e.source}\n${e.info}`}if(n.clipboardData){return n.clipboardData.setData("text",s)}else{return window.clipboardData.setData("text",s)}};document.body.addEventListener("copy",n)};const w=()=>{const t=document.getElementById("runtimeshow");if(t){const e=t.getAttribute("data-publishDate");t.textContent=`${btf.diffDate(e)} ${GLOBAL_CONFIG.runtime}`}};const E=()=>{const t=document.getElementById("last-push-date");if(t){const e=t.getAttribute("data-lastPushDate");t.textContent=btf.diffDate(e,true)}};const I=()=>{const t=document.querySelectorAll("#article-container table");if(!t.length)return;t.forEach(t=>{if(!t.closest(".highlight")){btf.wrap(t,"div",{class:"table-wrap"})}})};const G=()=>{const t=document.querySelectorAll("#article-container .hide-button");if(!t.length)return;t.forEach(t=>t.addEventListener("click",t=>{const e=t.currentTarget;e.classList.add("open");f(e.nextElementSibling.querySelectorAll(".gallery-container"))},{once:true}))};const O=()=>{const t=document.querySelectorAll("#article-container .tabs");if(!t.length)return;const e=(t,e)=>{t.forEach((t,n)=>{t.classList.toggle("active",n===e)})};const n=t=>{const n=t.target.closest("button");if(!n||n.classList.contains("active"))return;const o=[...t.currentTarget.children];const s=[...t.currentTarget.nextElementSibling.children];const i=o.indexOf(n);e(o,i);t.currentTarget.classList.remove("no-default");e(s,i);f(s[i].querySelectorAll(".gallery-container"),true)};const o=t=>e=>{if(e.target.closest("button")){btf.scrollToDest(btf.getEleTop(t),300)}};t.forEach(t=>{btf.addEventListenerPjax(t.firstElementChild,"click",n);btf.addEventListenerPjax(t.lastElementChild,"click",o(t))})};const A=()=>{const t=document.querySelector("#aside-cat-list.expandBtn");if(!t)return;const e=t=>{const e=t.target;if(e.nodeName==="I"){t.preventDefault();e.parentNode.classList.toggle("expand")}};btf.addEventListenerPjax(t,"click",e,true)};const C=()=>{const t=document.getElementById("post-outdate-notice");if(!t)return;const{limitDay:e,messagePrev:n,messageNext:o,postUpdate:s}=JSON.parse(t.getAttribute("data"));const i=btf.diffDate(s);if(i>=e){t.textContent=`${n} ${i} ${o}`;t.hidden=false}};const B=()=>{window.lazyLoadInstance=new LazyLoad({elements_selector:"img",threshold:0,data_src:"lazy-src"});btf.addGlobalFn("pjaxComplete",()=>{window.lazyLoadInstance.update()},"lazyload")};const x=t=>{t.forEach(t=>{t.textContent=btf.diffDate(t.getAttribute("datetime"),true);t.style.display="inline"})};const S=()=>{const t=document.getElementById("recent-posts");if(!(t&&t.classList.contains("masonry")))return;const e=()=>{const t=new InfiniteGrid.MasonryInfiniteGrid(".recent-post-items",{gap:{horizontal:10,vertical:20},useTransform:true,useResizeObserver:true});t.renderItems();btf.addGlobalFn("pjaxCompleteOnce",()=>{t.destroy()},"removeJustifiedIndexPostUI")};typeof InfiniteGrid==="function"?e():btf.getScript(`${GLOBAL_CONFIG.infinitegrid.js}`).then(e)};const T=()=>{window.addEventListener("resize",()=>{o(false);n&&btf.isHidden(document.getElementById("toggle-menu"))&&i.close()});const t=document.getElementById("menu-mask");t&&t.addEventListener("click",()=>{i.close()});b();GLOBAL_CONFIG.islazyloadPlugin&&B();GLOBAL_CONFIG.copyright!==undefined&&v();if(GLOBAL_CONFIG.autoDarkmode){window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",t=>{if(btf.saveToLocal.get("theme")!==undefined)return;t.matches?p("dark"):p("light")})}};const F=()=>{a();r();f(document.querySelectorAll("#article-container .gallery-container"));l();h();I();G();O()};const N=()=>{s();S();if(GLOBAL_CONFIG_SITE.pageType==="post"){C();GLOBAL_CONFIG.relativeDate.post&&x(document.querySelectorAll("#post-meta time"))}else{GLOBAL_CONFIG.relativeDate.homepage&&x(document.querySelectorAll("#recent-posts time"));GLOBAL_CONFIG.runtime&&w();E();A()}GLOBAL_CONFIG_SITE.pageType==="home"&&c();m();F();GLOBAL_CONFIG_SITE.pageType!=="shuoshuo"&&btf.switchComments(document);y()};btf.addGlobalFn("pjaxComplete",N,"refreshFn");N();T();window.addEventListener("hexo-blog-decrypt",t=>{F();window.translateFn.translateInitialization();Object.values(window.globalFn.encrypt).forEach(t=>{t()})})});
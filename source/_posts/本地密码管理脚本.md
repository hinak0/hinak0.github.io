---
title: 本地密码管理脚本
categories:
  - Linux运维
date: 2025-11-09 17:14:55
tags:
cover:
---

对于大部分不重要网站，采用hash+salt的方式生成唯一密码，方便管理

## 在线工具

<style>
#pw-tool {
  max-width: 400px;
  padding: 16px;
  border-radius: 8px;
  font-family: sans-serif;

  label {
    display: block;
    margin-bottom: 8px;
  }

  input {
    width: 100%;
    padding: 6px 8px;
    margin-top: 4px;
    margin-bottom: 12px;
    border-radius: 4px;
    box-sizing: border-box;
  }

  button {
    padding: 8px 16px;
    border-radius: 4px;
    cursor: pointer;
    margin-right: 8px;
    background: #4caf50;
    color: white;
    border: none;

    &:hover {
      background: #45a049;
    }
  }

  #result {
    display: inline-block;
    margin-top: 8px;
    font-weight: bold;
  }
}
</style>

<div id="pw-tool">
  <label>
    Seed:
    <input type="text" id="seed">
  </label>
  <label>
    HMAC key:
    <input type="password" id="key">
  </label>
  <label>
    Site:
    <input type="text" id="site">
  </label>
  <button id="gen">生成密码</button>
  <button id="copy">复制密码</button>
  <div>
    <strong>生成的密码:</strong>
    <span id="result"></span>
  </div>
</div>

<script>
  async function generateHmacPassword(seed, key, site) {
    const enc = new TextEncoder();
    const keyData = enc.encode(key);
    const msg = enc.encode(`${seed}|${site}`);

    const cryptoKey = await crypto.subtle.importKey(
      "raw", keyData, { name: "HMAC", hash: "SHA-256" }, false, ["sign"]
    );

    const sig = await crypto.subtle.sign("HMAC", cryptoKey, msg);
    const base64 = btoa(String.fromCharCode(...new Uint8Array(sig)));
    return base64.replace(/[^A-Za-z0-9]/g, "").slice(0, 12);
  }

  const resultEl = document.getElementById("result");

  document.getElementById("gen").addEventListener("click", async () => {
    const seed = document.getElementById("seed").value;
    const key = document.getElementById("key").value;
    const site = document.getElementById("site").value;

    if (!key || !site) {
      alert("HMAC key 和 Site 都不能为空");
      return;
    }

    const pw = await generateHmacPassword(seed, key, site);
    resultEl.textContent = pw;
  });

  document.getElementById("copy").addEventListener("click", () => {
    if (!resultEl.textContent) {
      alert("请先生成密码");
      return;
    }
    navigator.clipboard.writeText(resultEl.textContent)
      .then(() => alert("密码已复制到剪贴板"))
      .catch(() => alert("复制失败"));
  });
</script>

## 代码

```bash
hashpw() {
  site="$1"
  [ -n "$site" ] || { echo "Usage: hashpw sitename"; return 1; }

  seed="seed"

  echo -n "Enter HMAC key: "
  read -s key
  echo

  pw=$(printf '%s' "${seed}|${site}" \
       | openssl dgst -sha256 -hmac "${key}" -binary \
       | openssl base64 \
       | tr -dc 'A-Za-z0-9' \
       | cut -c1-12)

  echo "$pw"
}
```

```typescript
import * as crypto from "crypto";
import * as readline from "readline";

/**
 * 异步命令行输入
 * @param query 提示信息
 * @param hidden 是否隐藏输入（适合密码）
 * @returns 用户输入的字符串
 */
async function prompt(query: string, hidden = true): Promise<string> {
	return new Promise((resolve) => {
		const rl = readline.createInterface({
			input: process.stdin,
			output: process.stdout,
		});

		if (!hidden) {
			rl.question(query, (answer) => {
				rl.close();
				resolve(answer);
			});
		} else {
			// 隐藏输入
			process.stdout.write(query);
			const input: string[] = [];

			const onData = (char: Buffer) => {
				const str = char.toString();
				if (str === "\n" || str === "\r" || str === "\u0004") {
					process.stdin.removeListener("data", onData);
					rl.close();
					process.stdout.write("\n");
					resolve(input.join(""));
				} else {
					process.stdout.write("*"); // 输出星号
					input.push(str);
				}
			};

			process.stdin.on("data", onData);
		}
	});
}

async function hashpw() {
	const site = process.argv[2];
	if (!site) {
		console.log("Usage: ts-node hashpw.ts sitename");
		return;
	}

	const seed = "seed";
	const key = await prompt("Enter HMAC key: ", true);

	const hmac = crypto.createHmac("sha256", key);
	hmac.update(`${seed}|${site}`);
	const digest = hmac.digest("base64");

	const pw = digest.replace(/[^A-Za-z0-9]/g, "").slice(0, 12);

	console.log(pw);
}

hashpw();
```
